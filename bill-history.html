<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill History - Bill Reminder</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/config.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-dark: #3a56d4;
            --secondary-color: #48bfe3;
            --light-color: #f8f9fa;
            --dark-color: #1a1a2e;
            --success-color: #06d6a0;
            --warning-color: #ffd166;
            --danger-color: #ef476f;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.08);
            --sidebar-width: 240px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f7fc;
            transition: all 0.3s;
            overflow-x: hidden;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: var(--sidebar-width);
            background: var(--dark-color);
            color: white;
            padding-top: 20px;
            z-index: 100;
            transition: all 0.3s;
            box-shadow: 3px 0px 10px rgba(0,0,0,0.1);
        }

        .sidebar .logo-container {
            padding: 15px 25px;
            margin-bottom: 25px;
        }

        .sidebar .logo-container h4 {
            margin: 0;
            font-weight: 600;
            font-size: 1.4rem;
            letter-spacing: 0.5px;
        }

        .sidebar .nav-link {
            color: rgba(255,255,255,0.7);
            padding: 12px 25px;
            margin: 3px 0;
            border-radius: 0 30px 30px 0;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }

        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background-color: rgba(255,255,255,0.1);
        }

        .sidebar .nav-link.active {
            background-color: var(--primary-color);
        }

        .sidebar .nav-link i {
            margin-right: 15px;
            width: 24px;
            text-align: center;
        }

        /* Main Content Styles */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 30px;
            transition: all 0.3s;
            min-height: 100vh;
        }

        .page-title {
            margin-bottom: 30px;
            color: var(--dark-color);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title h2 {
            font-weight: 600;
            margin-bottom: 0;
        }

        /* Card Styles */
        .custom-card {
            background: white;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            transition: all 0.3s;
            border: none;
            overflow: hidden;
        }

        .custom-card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }

        .custom-card .card-header {
            background: transparent;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .custom-card .card-header .header-title {
            display: flex;
            align-items: center;
        }

        .custom-card .card-header h5 {
            margin: 0;
            font-weight: 600;
        }

        .card-header .header-icon {
            margin-right: 15px;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        /* Filter controls */
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            width: 100%;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .date-range {
            display: flex;
            gap: 10px;
        }

        .date-range .form-group {
            flex: 1;
        }

        .input-group-text {
            background-color: var(--primary-color);
            color: white;
            border: none;
            font-size: 0.8rem;
        }

        .dark-mode .input-group-text {
            background-color: var(--primary-dark);
        }

        /* Fix for date inputs on smaller screens */
        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }
            
            .input-group-prepend.input-group-append {
                margin: 5px 0;
                width: 100%;
                border-radius: 4px !important;
            }
            
            .input-group-prepend.input-group-append .input-group-text {
                width: 100%;
                border-radius: 4px !important;
            }
            
            .input-group > .form-control:not(:first-child) {
                border-top-left-radius: 4px;
                border-bottom-left-radius: 4px;
            }
            
            .input-group > .form-control:not(:last-child) {
                border-top-right-radius: 4px;
                border-bottom-right-radius: 4px;
            }
        }

        /* Bill Table */
        .bill-table {
            width: 100%;
        }

        .bill-table th {
            font-weight: 600;
            color: var (--dark-color);
            border-bottom: 2px solid rgba(0,0,0,0.1);
            padding: 12px 15px;
        }

        .bill-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            vertical-align: middle;
        }

        .bill-table tr:last-child td {
            border-bottom: none;
        }

        .bill-table tr:hover {
            background-color: rgba(0,0,0,0.01);
        }

        .bill-name {
            font-weight: 500;
            color: var(--dark-color);
            display: flex;
            align-items: center;
        }

        .bill-amount {
            font-weight: 600;
            color: var(--primary-color);
        }

        .bill-date {
            white-space: nowrap;
        }

        .bill-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
        }

        .bill-status.paid {
            background-color: rgba(6, 214, 160, 0.1);
            color: var(--success-color);
        }

        .bill-status.pending {
            background-color: rgba(255, 209, 102, 0.1);
            color: #f4a83a;
        }

        .bill-status.overdue {
            background-color: rgba(239, 71, 111, 0.1);
            color: var (--danger-color);
        }

        /* Category tags */
        .category-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            color: white;
            margin-left: 8px;
        }

        .category-tag.Utilities { background-color: rgba(67, 97, 238, 0.9); }
        .category-tag.Entertainment { background-color: rgba(239, 71, 111, 0.9); }
        .category-tag.Subscriptions { background-color: rgba(255, 209, 102, 0.9); color: #333; }
        .category-tag.Insurance { background-color: rgba(6, 214, 160, 0.9); }
        .category-tag.Rent { background-color: rgba(17, 138, 178, 0.9); }
        .category-tag.Transportation { background-color: rgba(155, 89, 182, 0.9); }
        .category-tag.Food { background-color: rgba(46, 204, 113, 0.9); }
        .category-tag.Other { background-color: rgba(108, 117, 125, 0.9); }

        /* Action buttons */
        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.05);
            color: #666;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            margin-right: 5px;
        }

        .action-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .action-btn.delete:hover {
            background: var(--danger-color);
        }

        .actions-cell {
            display: flex;
            justify-content: flex-end;
        }

        /* Pagination */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .pagination-container .pagination {
            flex-wrap: wrap;
        }

        .pagination {
            margin: 0;
        }

        .page-link {
            border-radius: 50% !important;
            margin: 0 3px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-color);
            border: 1px solid rgba(0,0,0,0.1);
        }

        .page-link:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .page-item.active .page-link {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .page-info {
            color: #666;
            font-size: 0.9rem;
        }

        /* Theme Switch Button */
        .theme-switch {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--dark-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .theme-switch:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        /* Export Button */
        .export-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .export-btn:hover {
            background-color: #05b386;
            transform: translateY(-2px);
        }

        /* No Bills Message */
        .no-bills-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px 20px;
            text-align: center;
        }

        .no-bills-icon {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }

        .no-bills-message {
            color: #888;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        /* Search input */
        .search-container {
            position: relative;
            max-width: 300px;
            margin-left: auto;
        }

        .search-input {
            border-radius: 30px;
            padding-left: 40px;
            border: 1px solid rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            border-color: var(--primary-color);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
        }

        /* Dark Mode Styles */
        .dark-mode {
            background-color: #121212;
            color: #f5f5f5;
        }

        .dark-mode .custom-card {
            background-color: #1e1e1e;
            color: #f5f5f5;
        }

        .dark-mode .bill-name,
        .dark-mode .page-title,
        .dark-mode .bill-table th {
            color: #f5f5f5;
        }

        .dark-mode .custom-card .card-header,
        .dark-mode .page-title,
        .dark-mode .pagination-container {
            border-color: #333;
        }

        .dark-mode .bill-table td {
            border-color: #333;
        }

        .dark-mode .bill-table tr:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .dark-mode .text-muted,
        .dark-mode .page-info,
        .dark-mode .filter-label {
            color: #aaa !important;
        }

        .dark-mode .theme-switch {
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        .dark-mode .search-input,
        .dark-mode .form-control {
            background-color: #2a2a2a;
            border-color: #333;
            color: #f5f5f5;
        }

        .dark-mode .action-btn {
            background: rgba(255,255,255,0.1);
            color: #ddd;
        }

        .dark-mode .category-tag.Subscriptions { 
            color: #222; 
        }

        .dark-mode .no-bills-icon {
            color: #444;
        }

        .dark-mode .no-bills-message {
            color: #aaa;
        }

        .dark-mode .page-link {
            background-color: #1e1e1e;
            border-color: #333;
            color: #f5f5f5;
        }

        /* Add these dark mode styles for the modal */
        .dark-mode .modal-content {
            background-color: #1e1e1e;
            color: #f5f5f5;
        }

        .dark-mode .modal-header, 
        .dark-mode .modal-footer {
            border-color: #333;
        }

        .dark-mode .modal-header .close {
            color: #f5f5f5;
            text-shadow: none;
        }

        .dark-mode .form-group label {
            color: #aaa;
        }

        .dark-mode .form-group .h5,
        .dark-mode .form-group .p {
            color: #f5f5f5;
        }

        .dark-mode .list-group-item {
            background-color: #2a2a2a;
            border-color: #333;
            color: #f5f5f5;
        }

        .dark-mode .modal-footer .btn-outline-secondary {
            color: #f5f5f5;
            border-color: #666;
        }

        .dark-mode .modal-footer .btn-outline-secondary:hover {
            background-color: #444;
        }

        /* Media Queries for Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
                overflow: hidden;
            }
            
            .sidebar .logo-container h4,
            .sidebar .nav-link span {
                display: none;
            }
            
            .sidebar .nav-link {
                padding: 15px 0;
                justify-content: center;
            }
            
            .sidebar .nav-link i {
                margin-right: 0;
                font-size: 1.2rem;
            }
            
            .main-content {
                margin-left: 70px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }
            
            .filter-controls {
                flex-direction: column;
            }
            
            .date-range {
                flex-direction: column;
                gap: 15px;
            }
            
            .page-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .search-container {
                width: 100%;
                max-width: none;
                margin-left: 0;
            }
            
            .table-responsive {
                margin: 0 -20px;
                width: calc(100% + 40px);
            }
            
            .hide-sm {
                display: none;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                position: fixed;
                bottom: 0;
                left: 0;
                top: auto;
                width: 100%;
                height: 60px;
                display: flex;
                flex-direction: row;
                padding: 0;
                z-index: 1000;
            }
            
            .sidebar .logo-container {
                display: none;
            }
            
            .sidebar .nav {
                display: flex;
                flex-direction: row;
                width: 100%;
                margin: 0;
                padding: 0;
            }
            
            .sidebar .nav-item {
                flex: 1;
            }
            
            .sidebar .nav-link {
                padding: 10px 0;
                text-align: center;
                border-radius: 0;
                height: 60px;
                justify-content: center;
                align-items: center;
                flex-direction: column;
            }
            
            .sidebar .nav-link i {
                margin: 0 0 5px 0;
                font-size: 1.1rem;
            }
            
            .sidebar .nav-link span {
                display: block;
                font-size: 0.7rem;
            }
            
            .main-content {
                margin-left: 0;
                padding-bottom: 80px;
            }
            
            .page-title h2 {
                font-size: 1.5rem;
            }
            
            .bill-table {
                min-width: 650px;
            }
            
            .pagination-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .page-info {
                order: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Switch Button -->
    <div class="theme-switch" id="themeSwitch">
        <i class="fas fa-moon"></i>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="logo-container">
            <h4><i class="fas fa-receipt mr-2"></i> BillTracker</h4>
        </div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="add-bill.html" class="nav-link">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add Bill</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="bill-history.html" class="nav-link active">
                    <i class="fas fa-history"></i>
                    <span>Bill History</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="ai-chat.html" class="nav-link">
                    <i class="fas fa-robot"></i>
                    <span>AI Assistant</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="reminders.html" class="nav-link">
                    <i class="fas fa-bell"></i>
                    <span>Reminders</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="insights.html" class="nav-link">
                    <i class="fas fa-lightbulb"></i>
                    <span>Insights</span>
                </a>
            </li>
        </ul>li class="nav-item">
    </nav>      <a href="developer.html" class="nav-link">
                    <i class="fas fa-code"></i>
    <!-- Main Content Area -->loper</span>
    <main class="main-content">
        <div class="page-title">
            <div>
                <h2>Bill History</h2>
                <p class="text-muted">View and manage your bill history</p>
            </div>ent Area -->
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="form-control search-input" id="searchBills" placeholder="Search bills...">
                <h2>Bill History</h2>
                <p class="text-muted">View and manage your bill history</p>
            </div>
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="form-control search-input" id="searchBills" placeholder="Search bills...">
            </div>
        </div>
        
        <!-- Filter Controls -->
        <div class="filter-controls">
    <div class="row w-100">
        <div class="col-md-6 col-lg-3 mb-3">
            <label for="categoryFilter" class="filter-label text-muted">Category</label>
            <select class="form-control" id="categoryFilter">
                <option value="all">All Categories</option>
                <option value="Utilities">Utilities</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Subscriptions">Subscriptions</option>
                <option value="Insurance">Insurance</option>
                <option value="Rent">Rent & Housing</option>
                <option value="Transportation">Transportation</option>
                <option value="Food">Food & Dining</option>
                <option value="Other">Other</option>
            </select>
        </div>
        
        <div class="col-md-6 col-lg-3 mb-3">
            <label for="statusFilter" class="filter-label text-muted">Status</label>
            <select class="form-control" id="statusFilter">
                <option value="all">All Statuses</option>
                <option value="paid">Paid</option>
                <option value="pending">Pending</option>
                <option value="overdue">Overdue</option>
            </select>
        </div>
        
        <div class="col-md-6 col-lg-3 mb-3">
            <label for="sortBy" class="filter-label text-muted">Sort By</label>
            <select class="form-control" id="sortBy">
                <option value="date-desc">Date (Newest)</option>
                <option value="date-asc">Date (Oldest)</option>
                <option value="amount-desc">Amount (High → Low)</option>
                <option value="amount-asc">Amount (Low → High)</option>
                <option value="name-asc">Name (A → Z)</option>
                <option value="name-desc">Name (Z → A)</option>
            </select>
        </div>
        
        <div class="col-md-6 col-lg-3 mb-3">
            <label class="filter-label text-muted">Date Range</label>
            <div class="input-group">
                <input type="date" class="form-control" id="startDate" aria-label="Start date">
                <div class="input-group-prepend input-group-append">
                    <span class="input-group-text">to</span>
                </div>
                <input type="date" class="form-control" id="endDate" aria-label="End date">
            </div>
        </div>
    </div>
</div>
        
        <!-- Bill History Table -->
        <div class="custom-card">
            <div class="card-header">
                <div class="header-title">
                    <i class="fas fa-list header-icon"></i>
                    <h5>All Bills</h5>
                </div>
                <button class="export-btn" id="exportData">
                    <i class="fas fa-file-export"></i>
                    <span>Export</span>
                </button>
            </div>
            <div class="d-flex justify-content-end my-3">
                <div class="form-inline">
                    <label for="pageSize" class="mr-2">Bills per page:</label>
                    <select id="pageSize" class="form-control form-control-sm">
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
            <div class="table-responsive">
                <table class="bill-table" id="billHistoryTable">
                    <thead>
                        <tr>
                            <th>Bill Name</th>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Due Date</th>
                            <th>Status</th>
                            <th class="text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="billTableBody">
                        <!-- Content will be loaded dynamically -->
                        <tr>
                            <td colspan="6" class="text-center py-5">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                                <p class="mt-3 text-muted">Loading bill history...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="pagination-container">
                <div class="page-info">Showing <span id="startCount">1</span>-<span id="endCount">10</span> of <span id="totalCount">0</span> bills</div>
                <ul class="pagination" id="paginationControls">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" id="prevPage">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    <li class="page-item active">
                        <a class="page-link" href="#">1</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">2</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">3</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#" id="nextPage">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Bill Details Modal -->
        <div class="modal fade" id="billDetailsModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalBillName">Bill Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Amount</label>
                                    <div class="h5" id="modalAmount">$0.00</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Due Date</label>
                                    <div class="h5" id="modalDueDate">--</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Category</label>
                                    <div class="h5" id="modalCategory">--</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Status</label>
                                    <div class="h5" id="modalStatus">--</div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Notes</label>
                            <div class="p" id="modalNotes">No notes available</div>
                        </div>
                        <div class="form-group">
                            <label>Payment History</label>
                            <ul class="list-group" id="paymentHistory">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    No payment records found
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                        <!-- Edit button removed -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Confirm Delete Modal -->
        <div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirm Delete</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete <strong id="deleteBillName">this bill</strong>?</p>
                        <p class="text-danger">This action cannot be undone.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                            <i class="fas fa-trash-alt mr-2"></i>Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
src="js/sidebar.js"></script>
    <!-- Required JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>ener('DOMContentLoaded', function() {
            // Theme togglingpopper.min.js"></script>
            const themeSwitch = document.getElementById('themeSwitch');path.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
            if (themeSwitch) {
                themeSwitch.addEventListener('click', function() {
                    document.body.classList.toggle('dark-mode');
                    const isDarkMode = document.body.classList.contains('dark-mode');
                    localStorage.setItem('darkMode', isDarkMode);emeSwitch = document.getElementById('themeSwitch');
                    
                    const icon = themeSwitch.querySelector('i');istener('click', function() {
                    if (isDarkMode) {rk-mode');
                        icon.className = 'fas fa-sun';DarkMode = document.body.classList.contains('dark-mode');
                    } else {DarkMode);
                        icon.className = 'fas fa-moon';
                    } const icon = themeSwitch.querySelector('i');
                });                    if (isDarkMode) {
a-sun';
                // Restore dark mode preference
                if (localStorage.getItem('darkMode') === 'true') {
                    document.body.classList.add('dark-mode');
                    const icon = themeSwitch.querySelector('i');
                    if (icon) {
                        icon.className = 'fas fa-sun';store dark mode preference
                    }f (localStorage.getItem('darkMode') === 'true') {
                }       document.body.classList.add('dark-mode');
            }                    const icon = themeSwitch.querySelector('i');

            // Variables for paginationssName = 'fas fa-sun';
            let currentPage = 1;
            let billsPerPage = 10;
            let filteredBills = [];
            let allBills = [];
            
            // Initialize date filters with current month
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);let allBills = [];
            
            document.getElementById('startDate').valueAsDate = firstDay;
            document.getElementById('endDate').valueAsDate = lastDay;const today = new Date();
            ar(), today.getMonth(), 1);
            // Bills per page dropdown event listener
            document.getElementById('pageSize').addEventListener('change', function() {
                billsPerPage = parseInt(this.value);
                currentPage = 1; // Reset to first page when changing page sizeById('endDate').valueAsDate = lastDay;
                displayBills();
                updatePagination();Bills per page dropdown event listener
            });document.getElementById('pageSize').addEventListener('change', function() {
             parseInt(this.value);
            // Fetch all billsge = 1; // Reset to first page when changing page size
            fetchBills();    displayBills();
            
            // Add event listeners for filter controls
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('startDate').addEventListener('change', applyFilters);
            document.getElementById('endDate').addEventListener('change', applyFilters);
            document.getElementById('sortBy').addEventListener('change', applyFilters);
            document.getElementById('searchBills').addEventListener('input', applyFilters);document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            ').addEventListener('change', applyFilters);
            // Add event listeners for paginations);
            document.getElementById('prevPage').addEventListener('click', function(e) {('endDate').addEventListener('change', applyFilters);
                e.preventDefault();ortBy').addEventListener('change', applyFilters);
                if (currentPage > 1) {d('searchBills').addEventListener('input', applyFilters);
                    currentPage--;
                    displayBills();d event listeners for pagination
                }ument.getElementById('prevPage').addEventListener('click', function(e) {
            });    e.preventDefault();
            
            document.getElementById('nextPage').addEventListener('click', function(e) {
                e.preventDefault();
                const totalPages = Math.ceil(filteredBills.length / billsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    displayBills();ent.getElementById('nextPage').addEventListener('click', function(e) {
                } e.preventDefault();
            });    const totalPages = Math.ceil(filteredBills.length / billsPerPage);
            es) {
            // Export button functionality
            document.getElementById('exportData').addEventListener('click', exportBillsToCSV);        displayBills();
            
            // Function to fetch bills from the server
            function fetchBills() {
                // Show loading indicator
                document.getElementById('billTableBody').innerHTML = `ElementById('exportData').addEventListener('click', exportBillsToCSV);
                    <tr>
                        <td colspan="6" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="sr-only">Loading...</span>dicator
                            </div>
                            <p class="mt-3 text-muted">Loading bill history...</p>
                        </td>td colspan="6" class="text-center py-5">
                    </tr>          <div class="spinner-border text-primary" role="status">
                `;                <span class="sr-only">Loading...</span>
                
                // Use setTimeout to prevent UI blocking during complex operationsss="mt-3 text-muted">Loading bill history...</p>
                setTimeout(() => {
                    fetch(`${getApiBaseUrl()}/bills`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! Status: ${response.status}`);eout to prevent UI blocking during complex operations
                            }
                            return response.json();`${getApiBaseUrl()}/bills`)
                        })> {
                        .then(bills => {
                            console.log('Bills fetched:', bills);    throw new Error(`HTTP error! Status: ${response.status}`);
                            
                            if (!Array.isArray(bills)) {
                                console.error('Expected array of bills but got:', typeof bills);
                                throw new Error('Invalid data format received from server');(bills => {
                            }console.log('Bills fetched:', bills);
                            
                            // Process bill data (same logic, ensuring all fields exist)
                            allBills = bills.map(bill => { but got:', typeof bills);
                                // ...existing bill processing code...ror('Invalid data format received from server');
                                let dueDate;
                                try {
                                    dueDate = bill.due_date ? new Date(bill.due_date) : new Date();ing all fields exist)
                                    if (isNaN(dueDate.getTime())) {
                                        console.warn(`Invalid date for bill '${bill.bill_name}', using current date instead`);g code...
                                        dueDate = new Date();ueDate;
                                    }
                                } catch (e) {due_date) : new Date();
                                    console.error('Error parsing date:', e);Time())) {
                                    dueDate = new Date();       console.warn(`Invalid date for bill '${bill.bill_name}', using current date instead`);
                                }        dueDate = new Date();
                                
                                const today = new Date();} catch (e) {
                                 parsing date:', e);
                                // Calculate bill status);
                                let status = 'pending';
                                if (dueDate < today) {
                                    status = 'overdue';);
                                } else if (bill.paid) {
                                    status = 'paid';/ Calculate bill status
                                }let status = 'pending';
                                ate < today) {
                                return {
                                    id: bill.id || `temp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                                    bill_name: bill.bill_name || 'Unnamed Bill',
                                    amount: bill.amount || 0,
                                    due_date: dueDate.toISOString(),
                                    category: bill.category || 'Other',
                                    notes: bill.notes || '',mp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                                    paid: !!bill.paid,.bill_name || 'Unnamed Bill',
                                    status: status,
                                    payments: Array.isArray(bill.payments) ? bill.payments : []  due_date: dueDate.toISOString(),
                                };     category: bill.category || 'Other',
                            });        notes: bill.notes || '',
                            
                            console.log('Processed bills:', allBills.length);        status: status,
                            l.payments : []
                            // Set wider date range to show all bills by default
                            const startDateEl = document.getElementById('startDate');
                            const endDateEl = document.getElementById('endDate');
                            
                            // Set a really wide date range to ensure all bills show up
                            const fiveYearsAgo = new Date();
                            fiveYearsAgo.setFullYear(fiveYearsAgo.getFullYear() - 5);const startDateEl = document.getElementById('startDate');
                            tById('endDate');
                            const fiveYearsFromNow = new Date();
                            fiveYearsFromNow.setFullYear(fiveYearsFromNow.getFullYear() + 5);// Set a really wide date range to ensure all bills show up
                            
                            startDateEl.valueAsDate = fiveYearsAgo;FullYear() - 5);
                            endDateEl.valueAsDate = fiveYearsFromNow;
                             new Date();
                            // Apply initial filtersw.setFullYear(fiveYearsFromNow.getFullYear() + 5);
                            applyFilters();  
                        })alueAsDate = fiveYearsAgo;
                        .catch(error => {
                            console.error('Error fetching bills:', error);
                            document.getElementById('billTableBody').innerHTML = ` initial filters
                                <tr>
                                    <td colspan="6" class="text-center py-5">
                                        <i class="fas fa-exclamation-circle fa-2x text-danger mb-3"></i>
                                        <p>Failed to load bills: ${error.message}</p>
                                        <button class="btn btn-outline-primary btn-sm mt-2" onclick="fetchBills()">
                                            <i class="fas fa-sync-alt mr-2"></i>Retry
                                        </button>olspan="6" class="text-center py-5">
                                    </td>   <i class="fas fa-exclamation-circle fa-2x text-danger mb-3"></i>
                                </tr>          <p>Failed to load bills: ${error.message}</p>
                            `;             <button class="btn btn-outline-primary btn-sm mt-2" onclick="fetchBills()">
                        });                    <i class="fas fa-sync-alt mr-2"></i>Retry
                }, 100);                           </button>
            }                                    </td>

            // Enhanced applyFilters function with better debugging
            function applyFilters() {
                const categoryFilter = document.getElementById('categoryFilter').value;
                const statusFilter = document.getElementById('statusFilter').value;
                const startDate = new Date(document.getElementById('startDate').value);
                const endDate = new Date(document.getElementById('endDate').value);
                const sortBy = document.getElementById('sortBy').value;
                const searchQuery = document.getElementById('searchBills').value.toLowerCase();const categoryFilter = document.getElementById('categoryFilter').value;
                .getElementById('statusFilter').value;
                // Set end date to end of dayt.getElementById('startDate').value);
                endDate.setHours(23, 59, 59, 999);const endDate = new Date(document.getElementById('endDate').value);
                tById('sortBy').value;
                console.log('Applying filters:');('searchBills').value.toLowerCase();
                console.log('- Category:', categoryFilter);
                console.log('- Status:', statusFilter);
                console.log('- Date range:', startDate.toDateString(), 'to', endDate.toDateString());
                console.log('- Search:', searchQuery);
                
                // Track exclusions by filter type, categoryFilter);
                let categoryExcluded = 0;, statusFilter);
                let statusExcluded = 0;ange:', startDate.toDateString(), 'to', endDate.toDateString());
                let dateExcluded = 0;, searchQuery);
                let searchExcluded = 0;
                ions by filter type
                // Filter bills
                filteredBills = allBills.filter(bill => {
                    const billDate = new Date(bill.due_date);dateExcluded = 0;
                    
                    // Check if bill matches category filter
                    if (categoryFilter !== 'all' && bill.category !== categoryFilter) {
                        categoryExcluded++;lls.filter(bill => {
                        return false;onst billDate = new Date(bill.due_date);
                    }
                    er
                    // Check if bill matches status filterter) {
                    if (statusFilter !== 'all' && bill.status !== statusFilter) {+;
                        statusExcluded++;
                        return false;
                    }
                    r
                    // Check if bill is within date rangetusFilter) {
                    if (billDate < startDate || billDate > endDate) {+;
                        dateExcluded++;
                        return false;
                    }
                    
                    // Check if bill matches search query
                    if (searchQuery && !bill.bill_name.toLowerCase().includes(searchQuery)) {
                        searchExcluded++;
                        return false;
                    }
                    bill matches search query
                    return true; if (searchQuery && !bill.bill_name.toLowerCase().includes(searchQuery)) {
                });        searchExcluded++;
                
                // Log filter results
                console.log('Filter results:');
                console.log('- Total bills:', allBills.length);
                console.log('- Excluded by category:', categoryExcluded);
                console.log('- Excluded by status:', statusExcluded);
                console.log('- Excluded by date:', dateExcluded);
                console.log('- Excluded by search:', searchExcluded);
                console.log('- Bills after filtering:', filteredBills.length);console.log('- Total bills:', allBills.length);
                tegory:', categoryExcluded);
                // Sort bills (existing code)cluded by status:', statusExcluded);
                switch (sortBy) {ed by date:', dateExcluded);
                    case 'date-desc':
                        filteredBills.sort((a, b) => new Date(b.due_date) - new Date(a.due_date)); Bills after filtering:', filteredBills.length);
                        break;
                    case 'date-asc':
                        filteredBills.sort((a, b) => new Date(a.due_date) - new Date(b.due_date));) {
                        break;
                    case 'amount-desc':
                        filteredBills.sort((a, b) => parseFloat(b.amount) - parseFloat(a.amount));
                        break;
                    case 'amount-asc':
                        filteredBills.sort((a, b) => parseFloat(a.amount) - parseFloat(b.amount));
                        break;c':
                    case 'name-asc':nt));
                        filteredBills.sort((a, b) => a.bill_name.localeCompare(b.bill_name));
                        break;:
                    case 'name-desc':nt));
                        filteredBills.sort((a, b) => b.bill_name.localeCompare(a.bill_name));
                        break;   case 'name-asc':
                }        filteredBills.sort((a, b) => a.bill_name.localeCompare(b.bill_name));
                
                // Reset to first page when filters changeesc':
                currentPage = 1;        filteredBills.sort((a, b) => b.bill_name.localeCompare(a.bill_name));
                
                // Display filtered bills
                displayBills();
                ge when filters change
                // Update pagination
                updatePagination();   
            }                // Display filtered bills

            // Modified displayBills function to include "Mark as Paid" button
            function displayBills() {
                const billTableBody = document.getElementById('billTableBody');updatePagination();
                
                // Validate filtered bills array
                if (!Array.isArray(filteredBills)) {
                    console.error('filteredBills is not an array:', filteredBills);
                    billTableBody.innerHTML = `bleBody = document.getElementById('billTableBody');
                        <tr>
                            <td colspan="6" class="text-center py-5">
                                <i class="fas fa-exclamation-triangle text-warning mb-3" style="font-size: 2rem;"></i>
                                <p>There was a problem with the bill data. Please try refreshing the page.</p>
                                <button class="btn btn-primary btn-sm mt-2" onclick="location.reload()">
                                    <i class="fas fa-redo mr-2"></i>Refresh Page
                                </button>olspan="6" class="text-center py-5">
                            </td>   <i class="fas fa-exclamation-triangle text-warning mb-3" style="font-size: 2rem;"></i>
                        </tr>          <p>There was a problem with the bill data. Please try refreshing the page.</p>
                    `;     <button class="btn btn-primary btn-sm mt-2" onclick="location.reload()">
                    return;                   <i class="fas fa-redo mr-2"></i>Refresh Page
                }                </button>
                
                // Calculate start and end indices for current page
                const startIndex = (currentPage - 1) * billsPerPage;
                const endIndex = Math.min(startIndex + billsPerPage, filteredBills.length);    return;
                
                // Update page info
                document.getElementById('startCount').textContent = filteredBills.length > 0 ? startIndex + 1 : 0;
                document.getElementById('endCount').textContent = endIndex;
                document.getElementById('totalCount').textContent = filteredBills.length;const endIndex = Math.min(startIndex + billsPerPage, filteredBills.length);
                
                // Clear table body
                billTableBody.innerHTML = '';document.getElementById('startCount').textContent = filteredBills.length > 0 ? startIndex + 1 : 0;
                unt').textContent = endIndex;
                // Check if there are no billsnt').textContent = filteredBills.length;
                if (filteredBills.length === 0) {
                    billTableBody.innerHTML = `le body
                        <tr>;
                            <td colspan="6">
                                <div class="no-bills-container">
                                    <i class="fas fa-search no-bills-icon"></i>
                                    <p class="no-bills-message">No bills found matching your filters</p>
                                    <button class="btn btn-outline-primary btn-sm" onclick="resetFilters()">
                                        <i class="fas fa-filter mr-2"></i>Reset Filters
                                    </button>lass="no-bills-container">
                                </div>   <i class="fas fa-search no-bills-icon"></i>
                            </td>       <p class="no-bills-message">No bills found matching your filters</p>
                        </tr>              <button class="btn btn-outline-primary btn-sm" onclick="resetFilters()">
                    `;             <i class="fas fa-filter mr-2"></i>Reset Filters
                    return;                   </button>
                }                </div>
                
                // Add rows for current page
                const currentPageBills = filteredBills.slice(startIndex, endIndex);    `;
                
                currentPageBills.forEach(bill => {
                    const row = document.createElement('tr');
                    t page
                    // Format due date(startIndex, endIndex);
                    const dueDate = new Date(bill.due_date);
                    const formattedDate = dueDate.toLocaleDateString('en-US', { bill => {
                        year: 'numeric', .createElement('tr');
                        month: 'short', 
                        day: 'numeric' Format due date
                    });const dueDate = new Date(bill.due_date);
                    dueDate.toLocaleDateString('en-US', { 
                    // Create status badge
                    const statusClass = { 
                        'paid': 'paid',
                        'pending': 'pending',
                        'overdue': 'overdue'
                    }[bill.status];// Create status badge
                    {
                    const statusText = {
                        'paid': 'Paid',
                        'pending': 'Pending',
                        'overdue': 'Overdue'
                    }[bill.status];
                    
                    // Add "Mark as Paid" button for pending/overdue bills
                    const markAsPaidButton = bill.status !== 'paid' ? 
                        `<button class="action-btn mark-paid-btn" data-id="${bill.id}" title="Mark as Paid">
                            <i class="fas fa-check"></i>
                        </button>` : '';
                    aid" button for pending/overdue bills
                    row.innerHTML = `rkAsPaidButton = bill.status !== 'paid' ? 
                        <td>mark-paid-btn" data-id="${bill.id}" title="Mark as Paid">
                            <div class="bill-name">k"></i>
                                ${bill.bill_name} : '';
                            </div>
                        </td>rHTML = `
                        <td>
                            <span class="category-tag ${bill.category || 'Other'}">${bill.category || 'Other'}</span>div class="bill-name">
                        </td>
                        <td class="bill-amount">$${parseFloat(bill.amount).toFixed(2)}</td>
                        <td class="bill-date">${formattedDate}</td>>
                        <td>
                            <span class="bill-status ${statusClass}">${statusText}</span>span class="category-tag ${bill.category || 'Other'}">${bill.category || 'Other'}</span>
                        </td>
                        <td class="actions-cell">
                            <button class="action-btn view-btn" data-id="${bill.id}" title="View Details">ate}</td>
                                <i class="fas fa-eye"></i>
                            </button>tatus ${statusClass}">${statusText}</span>
                            ${markAsPaidButton}
                            <button class="action-btn delete delete-btn" data-id="${bill.id}" data-name="${bill.bill_name}" title="Delete Bill">
                                <i class="fas fa-trash-alt"></i>lass="action-btn view-btn" data-id="${bill.id}" title="View Details">
                            </button>   <i class="fas fa-eye"></i>
                        </td>      </button>
                    `;        ${markAsPaidButton}
                    tn delete delete-btn" data-id="${bill.id}" data-name="${bill.bill_name}" title="Delete Bill">
                    billTableBody.appendChild(row);             <i class="fas fa-trash-alt"></i>
                });            </button>
                
                // Add event listeners for action buttons
                addActionButtonListeners();       
            }                    billTableBody.appendChild(row);

            // Add event listener for "Mark as Paid" functionality
            function addActionButtonListeners() {
                // ...existing code for view, edit, delete buttons...addActionButtonListeners();
                
                // Add handler for "Mark as Paid" button
                document.querySelectorAll('.mark-paid-btn').forEach(btn => {lity
                    btn.addEventListener('click', function() {
                        const billId = this.getAttribute('data-id');
                        const billName = filteredBills.find(b => b.id == billId)?.bill_name || 'this bill';
                        
                        // Find the bill in our filtered bills array
                        const bill = filteredBills.find(b => b.id == billId);addEventListener('click', function() {
                         = this.getAttribute('data-id');
                        if (!bill) {)?.bill_name || 'this bill';
                            alert('Error: Could not find the bill to update.');
                            return;/ Find the bill in our filtered bills array
                        }const bill = filteredBills.find(b => b.id == billId);
                        
                        // Check if this is a temporary ID (starts with "temp-")
                        if (typeof billId === 'string' && billId.startsWith('temp-')) {
                            alert('This bill was just added and cannot be marked as paid yet. Please refresh the page first.');
                            return;
                        }
                        a temporary ID (starts with "temp-")
                        // Confirm with usersWith('temp-')) {
                        if (!confirm(`Mark "${billName}" as paid?`)) {t added and cannot be marked as paid yet. Please refresh the page first.');
                            return; // User canceled   return;
                        }}
                        
                        // Create an updated bill object with paid status
                        const updatedBill = {(`Mark "${billName}" as paid?`)) {
                            ...bill, canceled
                            status: 'paid',
                            paid: true
                        };// Create an updated bill object with paid status
                        
                        // Delete existing bill
                        fetch(`${getApiBaseUrl()}/bills?id=${billId}`, {
                            method: 'DELETE'  paid: true
                        })
                        .then(response => {
                            // Check if response is okay first
                            if (!response.ok) {
                                throw new Error(`Server returned ${response.status}: ${response.statusText}`);ethod: 'DELETE'
                            }
                            
                            // After successful delete, create new bill with paid status
                            return fetch(`${getApiBaseUrl()}/bills`, {  // <-- UPDATED LINE HERE
                                method: 'POST',Error(`Server returned ${response.status}: ${response.statusText}`);
                                headers: {
                                    'Content-Type': 'application/json'
                                },w bill with paid status
                                body: JSON.stringify(updatedBill)urn fetch(`${getApiBaseUrl()}/bills`, {  // <-- UPDATED LINE HERE
                            });      method: 'POST',
                        })
                        .then(response => {lication/json'
                            // Check if response is okay
                            if (!response.ok) {
                                throw new Error(`Server returned ${response.status}: ${response.statusText}`););
                            }
                            
                            // Try to parse as JSON, but handle other content types
                            const contentType = response.headers.get('content-type');
                            if (contentType && contentType.includes('application/json')) { returned ${response.status}: ${response.statusText}`);
                                return response.json();
                            } else {
                                return response.text().then(text => ({
                                    message: text || 'Bill marked as paid successfully!'ntentType = response.headers.get('content-type');
                                }));f (contentType && contentType.includes('application/json')) {
                            }      return response.json();
                        })
                        .then(data => {t().then(text => ({
                            // Show success message'
                            alert(data.message || 'Bill marked as paid successfully!');    }));
                            
                            // Refresh bills
                            fetchBills();hen(data => {
                        })ss message
                        .catch(error => {lly!');
                            console.error('Error marking bill as paid:', error);
                            alert(`Error marking bill as paid: ${error.message || 'Unknown error'}. The server might be down or the bill ID might be invalid.`); // Refresh bills
                        });     fetchBills();
                    });     })
                });        .catch(error => {
                error('Error marking bill as paid:', error);
                // View bill detailsmessage || 'Unknown error'}. The server might be down or the bill ID might be invalid.`);
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const billId = this.getAttribute('data-id');
                        const bill = filteredBills.find(b => b.id == billId);
                        s
                        if (bill) {btn => {
                            // Populate modal with bill details
                            document.getElementById('modalBillName').textContent = bill.bill_name;
                            document.getElementById('modalAmount').textContent = `$${parseFloat(bill.amount).toFixed(2)}`; billId);
                            const dueDate = new Date(bill.due_date);
                            document.getElementById('modalDueDate').textContent = dueDate.toLocaleDateString('en-US', { 
                                year: 'numeric', ith bill details
                                month: 'long', ById('modalBillName').textContent = bill.bill_name;
                                day: 'numeric' ument.getElementById('modalAmount').textContent = `$${parseFloat(bill.amount).toFixed(2)}`;
                            });
                            document.getElementById('modalCategory').textContent = bill.category || 'Other';yId('modalDueDate').textContent = dueDate.toLocaleDateString('en-US', { 
                            const statusText = {, 
                                'paid': 'Paid',
                                'pending': 'Pending',
                                'overdue': 'Overdue'
                            }[bill.status];
                            document.getElementById('modalStatus').innerHTML = `<span class="bill-status ${bill.status}">${statusText}</span>`;
                            document.getElementById('modalNotes').textContent = bill.notes || 'No notes available';    'paid': 'Paid',
                            
                            // Show payment history if available
                            const paymentHistory = document.getElementById('paymentHistory');
                            if (bill.payments && bill.payments.length > 0) {us').innerHTML = `<span class="bill-status ${bill.status}">${statusText}</span>`;
                                paymentHistory.innerHTML = '';textContent = bill.notes || 'No notes available';
                                bill.payments.forEach(payment => {
                                    const li = document.createElement('li');
                                    li.className = 'list-group-item d-flex justify-content-between align-items-center';mentHistory');
                                    const paymentDate = new Date(payment.date);l.payments.length > 0) {
                                    li.innerHTML = `y.innerHTML = '';
                                        <div>
                                            <strong>${paymentDate.toLocaleDateString()}</strong>
                                            ${payment.method ? `<span class="text-muted ml-2">(${payment.method})</span>` : ''}me = 'list-group-item d-flex justify-content-between align-items-center';
                                        </div>
                                        <span class="badge badge-primary badge-pill">$${parseFloat(payment.amount).toFixed(2)}</span>.innerHTML = `
                                    `;
                                    paymentHistory.appendChild(li);         <strong>${paymentDate.toLocaleDateString()}</strong>
                                });        ${payment.method ? `<span class="text-muted ml-2">(${payment.method})</span>` : ''}
                            } else {
                                paymentHistory.innerHTML = `}</span>
                                    <li class="list-group-item d-flex justify-content-between align-items-center text-muted">
                                        No payment records foundntHistory.appendChild(li);
                                    </li>;
                                `; else {
                            }    paymentHistory.innerHTML = `
                            ntent-between align-items-center text-muted">
                            // Show the modal (removed reference to editBillBtn)
                            $('#billDetailsModal').modal('show');           </li>
                        }         `;
                    });         }
                });            
                 Show the modal (removed reference to editBillBtn)
                // Delete bill
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const billId = this.getAttribute('data-id');
                        const billName = this.getAttribute('data-name');
                        
                        // Set bill name in confirmation modal
                        document.getElementById('deleteBillName').textContent = billName;addEventListener('click', function() {
                        e('data-id');
                        // Set up confirm delete button
                        document.getElementById('confirmDeleteBtn').setAttribute('data-id', billId);
                        mation modal
                        // Show confirmation modal').textContent = billName;
                        $('#confirmDeleteModal').modal('show'); 
                    });     // Set up confirm delete button
                });        document.getElementById('confirmDeleteBtn').setAttribute('data-id', billId);
                
                // Confirm delete button
                document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
                    const billId = this.getAttribute('data-id');});
                    
                    // Delete bill from server
                    fetch(`${getApiBaseUrl()}/bills?id=${billId}`, {
                        method: 'DELETE'nt.getElementById('confirmDeleteBtn').addEventListener('click', function() {
                    }).getAttribute('data-id');
                    .then(response => {
                        // Check if response is okay firstver
                        if (!response.ok) {
                            throw new Error(`Server returned ${response.status}: ${response.statusText}`);ethod: 'DELETE'
                        }
                        
                        // Try to parse as JSON, but handle other content types
                        const contentType = response.headers.get('content-type');
                        if (contentType && contentType.includes('application/json')) { returned ${response.status}: ${response.statusText}`);
                            return response.json();
                        } else {
                            // If not JSON, get text and create a simple objectcontent types
                            return response.text().then(text => ({e');
                                message: text || 'Bill deleted successfully!'entType && contentType.includes('application/json')) {
                            }));   return response.json();
                        }  } else {
                    })ot JSON, get text and create a simple object
                    .then(data => {sponse.text().then(text => ({
                        // Hide modalsuccessfully!'
                        $('#confirmDeleteModal').modal('hide');    }));
                        
                        // Show success message
                        alert(data.message || 'Bill deleted successfully!');n(data => {
                        
                        // Refresh billsleteModal').modal('hide');
                        fetchBills();  
                    })ss message
                    .catch(error => {lly!');
                        console.error('Error deleting bill:', error);
                        lls
                        // Hide modal
                        $('#confirmDeleteModal').modal('hide');
                        
                        // More informative error message
                        alert(`Error deleting bill: ${error.message || 'Unknown error'}. The server might be down or the bill ID might be invalid.`); 
                    });     // Hide modal
                });           $('#confirmDeleteModal').modal('hide');
            }                        
message
            // Function to handle edit bill action bill: ${error.message || 'Unknown error'}. The server might be down or the bill ID might be invalid.`);
            function handleEditBill(billId) {
                // Find the bill in the filtered bills array
                const bill = filteredBills.find(b => b.id == billId);
                
                if (bill) {
                    // Save the current bill to sessionStorage for use on the edit page
                    sessionStorage.setItem('editingBill', JSON.stringify(bill));ind the bill in the filtered bills array
                    d == billId);
                    // Log action (useful for debugging)
                    console.log(`Editing bill: ${bill.bill_name} (ID: ${billId})`);bill) {
                    for use on the edit page
                    // Show feedback to user before redirectingy(bill));
                    const toastElement = document.createElement('div');
                    toastElement.style.position = 'fixed';)
                    toastElement.style.bottom = '20px';.bill_name} (ID: ${billId})`);
                    toastElement.style.left = '20px';
                    toastElement.style.backgroundColor = 'var(--primary-color)';irecting
                    toastElement.style.color = 'white';nt('div');
                    toastElement.style.padding = '10px 15px';
                    toastElement.style.borderRadius = '5px';
                    toastElement.style.zIndex = '9999';
                    toastElement.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
                    toastElement.innerHTML = `<i class="fas fa-edit mr-2"></i>Preparing to edit "${bill.bill_name}"...`;
                    document.body.appendChild(toastElement);toastElement.style.padding = '10px 15px';
                    
                    // Redirect to edit page after short delay to show the toast message.zIndex = '9999';
                    setTimeout(() => {)';
                        window.location.href = `edit-bill.html?id=${billId}`;ment.innerHTML = `<i class="fas fa-edit mr-2"></i>Preparing to edit "${bill.bill_name}"...`;
                    }, 300);ment.body.appendChild(toastElement);
                } else {
                    console.error(`Bill with ID ${billId} not found`);
                    alert('Error: Could not find the bill to edit. Please try refreshing the page.');   setTimeout(() => {
                }           window.location.href = `edit-bill.html?id=${billId}`;
            }                    }, 300);

            // Function to reset filtersD ${billId} not found`);
            window.resetFilters = function() {e try refreshing the page.');
                document.getElementById('categoryFilter').value = 'all';
                document.getElementById('statusFilter').value = 'all';
                document.getElementById('sortBy').value = 'date-desc';
                document.getElementById('searchBills').value = '';unction to reset filters
                
                // Reset date filters to current monthcategoryFilter').value = 'all';
                const today = new Date();
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                document.getElementById('startDate').valueAsDate = firstDay;
                document.getElementById('endDate').valueAsDate = lastDay;// Reset date filters to current month
                ();
                // Apply reset filters= new Date(today.getFullYear(), today.getMonth(), 1);
                applyFilters();  const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            };                document.getElementById('startDate').valueAsDate = firstDay;
te').valueAsDate = lastDay;
            // Function to export bills to CSV
            function exportBillsToCSV() {rs
                // Create CSV header
                let csv = 'Bill Name,Category,Amount,Due Date,Status\n';
                
                // Add each bill as a row
                filteredBills.forEach(bill => {
                    const dueDate = new Date(bill.due_date);
                    const formattedDate = dueDate.toLocaleDateString('en-US');csv = 'Bill Name,Category,Amount,Due Date,Status\n';
                    
                    // Format bill dataas a row
                    const row = [
                        `"${bill.bill_name.replace(/"/g, '""')}"`,  // Escape quotes in bill name.due_date);
                        bill.category || 'Other',ateString('en-US');
                        parseFloat(bill.amount).toFixed(2),
                        formattedDate,
                        bill.status.charAt(0).toUpperCase() + bill.status.slice(1)  // Capitalize statusnst row = [
                    ];    `"${bill.bill_name.replace(/"/g, '""')}"`,  // Escape quotes in bill name
                    ,
                    csv += row.join(',') + '\n';     parseFloat(bill.amount).toFixed(2),
                });        formattedDate,
                rAt(0).toUpperCase() + bill.status.slice(1)  // Capitalize status
                // Create download link
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', `bills_export_${new Date().toISOString().slice(0, 10)}.csv`);
                document.body.appendChild(link);const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                ateObjectURL(blob);
                // Trigger downloaddocument.createElement('a');
                link.click();link.href = url;
                ribute('download', `bills_export_${new Date().toISOString().slice(0, 10)}.csv`);
                // Clean up
                document.body.removeChild(link);   
            }                // Trigger download

            // Debug function to inspect data loading issues
            window.debugBillsData = function() {
                fetch(`${getApiBaseUrl()}/bills`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('--- DEBUG: BILLS DATA ---');
                        console.log('Total bills:', data.length);
                        console.log('First 3 bills:', data.slice(0, 3));{getApiBaseUrl()}/bills`)
                        n())
                        // Check for common issues
                        const issues = [];ATA ---');
                        data.forEach((bill, index) => {
                            if (!bill.id) issues.push(`Bill at index ${index} has no ID`);
                            if (!bill.bill_name) issues.push(`Bill at index ${index} has no name`);
                            if (bill.amount === undefined) issues.push(`Bill at index ${index} has no amount`);
                            if (!bill.due_date) issues.push(`Bill at index ${index} has no due date`);t issues = [];
                            x) => {
                            // Check date format
                            if (bill.due_date && isNaN(new Date(bill.due_date).getTime())) {
                                issues.push(`Bill at index ${index} (${bill.bill_name}) has invalid date format: ${bill.due_date}`);f (bill.amount === undefined) issues.push(`Bill at index ${index} has no amount`);
                            } if (!bill.due_date) issues.push(`Bill at index ${index} has no due date`);
                        });    
                        
                        console.log('Issues found:', issues.length > 0 ? issues : 'None');bill.due_date).getTime())) {
                        console.log('------------------------');        issues.push(`Bill at index ${index} (${bill.bill_name}) has invalid date format: ${bill.due_date}`);
                        
                        // Show results in UI if there are issues
                        if (issues.length > 0) {
                            alert(`Found ${issues.length} issues with your bills data. See console for details.`);log('Issues found:', issues.length > 0 ? issues : 'None');
                        } else {
                            alert('Bills data looks good! Check console for details.');
                        }  // Show results in UI if there are issues
                    })ngth > 0) {
                    .catch(error => {r bills data. See console for details.`);
                        console.error('Error in debug function:', error);
                        alert('Error accessing bills data. See console for details.');     alert('Bills data looks good! Check console for details.');
                    });          }
            };                    })

            // Add a hidden debug button error);
            const debugButton = document.createElement('button');
            debugButton.className = 'btn btn-sm btn-outline-secondary position-fixed';
            debugButton.style.bottom = '10px';
            debugButton.style.right = '10px';
            debugButton.style.opacity = '0.6';
            debugButton.style.zIndex = '1000';
            debugButton.innerHTML = '<i class="fas fa-bug"></i>';-outline-secondary position-fixed';
            debugButton.title = 'Debug Bills Data';
            debugButton.addEventListener('click', window.debugBillsData);
            document.body.appendChild(debugButton);    debugButton.style.opacity = '0.6';
        
        // Move the updatePagination function inside the DOMContentLoaded event handler<i class="fas fa-bug"></i>';
        function updatePagination() {
            const totalPages = Math.ceil(filteredBills.length / billsPerPage);
            const paginationControls = document.getElementById('paginationControls');document.body.appendChild(debugButton);
            
            // Clear pagination controls except first and last items (prev and next buttons)ContentLoaded event handler
            while (paginationControls.children.length > 2) {
                paginationControls.removeChild(paginationControls.children[1]);onst totalPages = Math.ceil(filteredBills.length / billsPerPage);
            }const paginationControls = document.getElementById('paginationControls');
            
            // Update previous buttonxt buttons)
            const prevButton = document.getElementById('prevPage').parentElement;
            prevButton.className = currentPage === 1 ? 'page-item disabled' : 'page-item';    paginationControls.removeChild(paginationControls.children[1]);
            
            // Update next button
            const nextButton = document.getElementById('nextPage').parentElement;
            nextButton.className = currentPage === totalPages || totalPages === 0 ? 'page-item disabled' : 'page-item';const prevButton = document.getElementById('prevPage').parentElement;
            rentPage === 1 ? 'page-item disabled' : 'page-item';
            // Add page number buttons
            if (totalPages <= 5) {
                // Show all pages if 5 or fewer'nextPage').parentElement;
                for (let i = 1; i <= totalPages; i++) {rrentPage === totalPages || totalPages === 0 ? 'page-item disabled' : 'page-item';
                    addPageButton(i);
                }age number buttons
            } else {
                // Show first page, current page, and last page with ellipses if 5 or fewer
                addPageButton(1);for (let i = 1; i <= totalPages; i++) {
                
                if (currentPage > 2) {
                    addEllipsis();e {
                }// Show first page, current page, and last page with ellipses
                
                if (currentPage !== 1 && currentPage !== totalPages) {
                    addPageButton(currentPage);f (currentPage > 2) {
                }    addEllipsis();
                
                if (currentPage < totalPages - 1) {
                    addEllipsis();f (currentPage !== 1 && currentPage !== totalPages) {
                }    addPageButton(currentPage);
                
                if (totalPages > 1) {
                    addPageButton(totalPages);f (currentPage < totalPages - 1) {
                }       addEllipsis();
            }    }
            
            // Function to add page number button
            function addPageButton(pageNum) {
                const li = document.createElement('li');
                li.className = pageNum === currentPage ? 'page-item active' : 'page-item';
                
                const a = document.createElement('a'); button
                a.className = 'page-link';utton(pageNum) {
                a.href = '#';teElement('li');
                a.textContent = pageNum;li.className = pageNum === currentPage ? 'page-item active' : 'page-item';
                
                a.addEventListener('click', function(e) {teElement('a');
                    e.preventDefault();
                    currentPage = pageNum;
                    displayBills();;
                    updatePagination();
                });a.addEventListener('click', function(e) {
                lt();
                li.appendChild(a);
                paginationControls.insertBefore(li, nextButton);       displayBills();
            }        updatePagination();
            
            // Function to add ellipsis
            function addEllipsis() {
                const li = document.createElement('li');nextButton);
                li.className = 'page-item disabled';
                
                const a = document.createElement('a');
                a.className = 'page-link';sis() {
                a.href = '#';eElement('li');
                a.innerHTML = '&hellip;';li.className = 'page-item disabled';
                
                li.appendChild(a);
                paginationControls.insertBefore(li, nextButton);   a.className = 'page-link';
            }       a.href = '#';
        }         a.innerHTML = '&hellip;';
    });            
    
    // Remove the updatePagination function that was outside the DOMContentLoaded event handler
    // This function doesn't have access to filteredBills and was causing the error
    </script> }
</body>

</html>    
    // Remove the updatePagination function that was outside the DOMContentLoaded event handler
    // This function doesn't have access to filteredBills and was causing the error
    </script>
</body>
</html>